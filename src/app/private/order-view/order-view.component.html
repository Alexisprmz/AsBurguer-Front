<div class="order-container">
  <form [formGroup]="_order.formOrder" (ngSubmit)="placeOrder()">

    <div class="order-header">
      <div class="header-title">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M4 18V6C4 4.343 5.343 3 7 3H17C18.657 3 20 4.343 20 6V18C20 19.657 18.657 21 17 21H7C5.343 21 4 19.657 4 18Z"/>
          <path d="M8 7H16"/>
          <path d="M8 11H16"/>
          <path d="M8 15H12"/>
        </svg>
        <h1>Resumen de Orden</h1>
      </div>

      <div class="header-content">
        <div class="client-info">
          <label>Nombre del Cliente</label>
          <div class="input-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="12" cy="8" r="4"/>
              <path d="M5 20c0-4 3.5-7 7-7s7 3 7 7"/>
            </svg>
            <input type="text" formControlName="client" [readonly]="rol === 3" placeholder="Nombre del cliente">
          </div>
        </div>

        <div class="order-type-global">
          <label>Tipo de Orden (General)</label>
          <mat-radio-group (change)="selected($event)" class="radio-group">
            @if(rol !== 3) {
              <mat-radio-button [value]="1">Comer aqui</mat-radio-button>
            }
            <mat-radio-button [value]="0" [checked]="rol === 3">Para llevar</mat-radio-button>
          </mat-radio-group>
        </div>
      </div>
    </div>

    <div class="products-order" formArrayName="order_details">
      @for (item of eachProduct().controls; track item; let idx = $index) {
        <div class="product">
          <div class="ticket-header">
            <h3>{{ item.value.name }}</h3>
            <span class="category-badge">{{ item.value.name_category }}</span>
            <div class="price-tag">{{ item.value.unit_price | currency }}</div>
          </div>

          <div class="ticket-body">
            <div class="order-type-selector" [formGroupName]="idx">
              <label>Tipo de servicio</label>
              <mat-radio-group formControlName="order_type" class="radio-group">
                @if(rol !== 3) {
                  <mat-radio-button [value]="1">Comer aqui</mat-radio-button>
                }
                <mat-radio-button [value]="0">Para llevar</mat-radio-button>
              </mat-radio-group>
            </div>

            @if (filterExtras(item.value, 1).length) {
              <div class="extras-section">
                <span class="section-title">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14"/>
                  </svg>
                  Extras
                </span>
                <div class="items-list">
                  @for (ingredient of filterExtras(item.value, 1); track ingredient.name) {
                    <div class="extra-item">
                      <span class="extra-name">{{ ingredient.name }}</span>
                      <span class="extra-price">+{{ ingredient.price | currency }}</span>
                    </div>
                  }
                </div>
              </div>
            }

            @if (filterExtras(item.value, 0).length) {
              <div class="exceptions-section">
                <span class="section-title">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14"/>
                  </svg>
                  Sin
                </span>
                <div class="items-list">
                  @for (ingredient of filterExtras(item.value, 0); track ingredient.name) {
                    <div class="exception-item">
                      <span>Sin {{ ingredient.name }}</span>
                    </div>
                  }
                </div>
              </div>
            }

            <div class="comments-section" [formGroupName]="idx">
              @if (item.value.comments && item.value.comments.trim()) {
                <div class="section-title">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                  </svg>
                  Comentarios
                </div>
                <div class="comments-content">
                  <p class="comment-text">{{ item.value.comments }}</p>
                </div>
              }
            </div>
          </div>

          <div class="ticket-footer">
            <button type="button" (click)="deleteProduct(idx)" class="delete-btn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14z"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
              </svg>
              Eliminar
            </button>
          </div>
        </div>
      }
    </div>

    <div class="total-container">
      <div class="totals-wrapper">
        <div class="subtotal">
          <span class="label">Subtotal productos</span>
          <span class="value">{{ totalProducts() | currency }}</span>
        </div>
        <div class="total-extras">
          <span class="label">Total extras</span>
          <span class="value">+{{ totalExtras() | currency }}</span>
        </div>
        <div class="divider"></div>
        <div class="total-order">
          <span class="label">Total</span>
          <span class="value">{{ totalOrder() | currency }}</span>
        </div>
      </div>
    </div>

    <div class="buttons">
      <button type="button" [routerLink]="['/private/menu']" class="btn-secondary">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Regresar al menu
      </button>
      <button type="submit" class="btn-primary">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12l5 5L20 7"/>
        </svg>
        Confirmar Orden
      </button>
    </div>

  </form>
</div>